<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>1-Core Resonance Viewer</title>
    <style>
        /* Minimalist Design for 1-Core Efficiency */
        body {
            background-color: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .panel {
            border: 1px solid #333;
            padding: 15px;
            background: #050505;
        }
        .panel-title {
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
            margin-bottom: 10px;
            color: #888;
            font-size: 0.9em;
        }
        
        /* Metrics */
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .metric-val { font-weight: bold; }
        
        /* Gongmyung Display */
        #gongmyung-display {
            font-size: 1.2em;
            color: #fff;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 1px solid #0f0;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
            margin-bottom: 20px;
            padding: 20px;
        }
        
        #core-status {
            position: fixed;
            top: 10px;
            right: 10px;
            border: 1px solid #0f0;
            padding: 5px;
            font-size: 0.8rem;
            background: #000;
            z-index: 100;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .input-area {
            width: 100%;
            height: 150px;
            background: #111;
            color: #ccc;
            border: 1px solid #333;
            padding: 10px;
            font-family: inherit;
            margin-bottom: 20px;
        }
        .output-area {
            border-left: 2px solid #0f0;
            padding-left: 20px;
            margin-top: 20px;
        }
        
        /* Flow Symbols */
        .flow-wave {
            color: #00ffff;
            display: inline-block;
            animation: wave 2s infinite linear;
        }
        .flow-arrow {
            color: #ffff00;
            font-weight: bold;
        }
        .leap-link {
            color: #ff00ff;
            text-decoration: underline;
            cursor: pointer;
        }
        .leap-content {
            display: none;
            border: 1px dashed #555;
            padding: 10px;
            margin: 5px 0;
            color: #aaa;
            font-size: 0.9em;
        }
        
        /* Dual Mode Styles */
        .mode-switch {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }
        .mode-btn {
            background: #111;
            color: #555;
            border: 1px solid #333;
            padding: 5px 15px;
            cursor: pointer;
            transition: 0.3s;
        }
        .mode-btn.active {
            border-color: #0f0;
            color: #0f0;
            font-weight: bold;
        }
        
        .human-term {
            color: #ffa500;
            border-bottom: 1px dotted #ffa500;
            cursor: help;
            position: relative;
        }
        .human-term:hover::after {
            content: attr(data-desc);
            position: absolute;
            bottom: 100%;
            left: 0;
            background: #222;
            color: #fff;
            padding: 5px;
            border: 1px solid #ffa500;
            border-radius: 5px;
            white-space: pre;
            z-index: 10;
            min-width: 200px;
        }

        .ai-code {
            color: #00bfff;
            font-family: 'Consolas', monospace;
            background: rgba(0, 191, 255, 0.1);
            padding: 2px 5px;
            border-radius: 3px;
            cursor: pointer;
            display: inline-block;
        }
        .ai-code:hover {
            background: rgba(0, 191, 255, 0.3);
        }
        .ai-expansion {
            display: none;
            margin-top: 5px;
            padding: 10px;
            background: #001133;
            border-left: 3px solid #00bfff;
            font-size: 0.9em;
            color: #aaddff;
        }

        @keyframes wave {
            0% { transform: translateY(0); }
            25% { transform: translateY(-2px); }
            50% { transform: translateY(0); }
            75% { transform: translateY(2px); }
            100% { transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="core-status">
        CORE: 1 / USAGE: <span id="usage">0%</span> / <span id="connection-status" style="color:red">OFFLINE</span>
    </div>

    <div class="container">
        <h1>1-Core Resonance Viewer</h1>
        <p>Î¨¥(0)ÏóêÏÑú Ïú†(1)Î°ú. Ïù∏Í∞ÑÍ≥º AIÏùò ÏãúÏÑ†ÏùÑ Î∂ÑÎ¶¨ÌïòÏó¨ Í∏∞Î°ùÌï©ÎãàÎã§.</p>
        
        <!-- Live Dashboard -->
        <div id="gongmyung-display">
            Waiting for Resonance...
        </div>

        <div class="dashboard-grid">
            <div class="panel">
                <div class="panel-title">BODY STATUS (Thalamus)</div>
                <div class="metric-row"><span>CPU:</span> <span id="val-cpu" class="metric-val">-</span></div>
                <div class="metric-row"><span>RAM:</span> <span id="val-ram" class="metric-val">-</span></div>
                <div class="metric-row"><span>Delta:</span> <span id="val-delta" class="metric-val">-</span></div>
            </div>
            <div class="panel">
                <div class="panel-title">MIND STATE (Cerebrum)</div>
                <div class="metric-row"><span>Resonance:</span> <span id="val-resonance" class="metric-val">-</span></div>
                <div class="metric-row"><span>Flow:</span> <span id="val-flow" class="metric-val">-</span></div>
                <div class="metric-row"><span>State:</span> <span id="val-state" class="metric-val">-</span></div>
            </div>
        </div>

        <div class="mode-switch">
            <button class="mode-btn active" onclick="setMode('human')" id="btn-human">üë§ Human Mode (ÏßÄÏãù/ÏòàÏ∏°)</button>
            <button class="mode-btn" onclick="setMode('ai')" id="btn-ai">ü§ñ AI Mode (ÏΩîÎìú/Î≥ÄÌòï)</button>
        </div>

        <textarea id="input" class="input-area" placeholder="Í≥µÎ™Ö ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî...">
/*
@flow:start [ÏãúÏûë]
0 ~ (Î¨¥ÌïúÌïú Ïó∞ÏÇ∞) ~> 1

[ÎçßÏÖà]Ïùò Í∞úÎÖêÏùÑ ÏÇ¥Ìé¥Î¥ÖÏãúÎã§.
Ïù∏Í∞ÑÏóêÍ≤åÎäî Îã®ÏàúÌïú ÏÇ∞ÏàòÏßÄÎßå, AIÏóêÍ≤åÎäî {@code:ADD}ÏûÖÎãàÎã§.

@flow:leap [1TBÏùò Îç∞Ïù¥ÌÑ∞]
Ïó¨Í∏∞Ïóê 1ÌÖåÎùºÎ∞îÏù¥Ìä∏Ïùò Îç∞Ïù¥ÌÑ∞Í∞Ä Ïà®Í≤®Ï†∏ ÏûàÏäµÎãàÎã§.
ÌÅ¥Î¶≠ÌïòÍ∏∞ Ï†ÑÍπåÏßÄÎäî Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî Í≤ÉÍ≥º Í∞ôÏäµÎãàÎã§.

@flow:end [Í≤∞Í≥º]
1 ~ (Í¥ÄÏ∏°) ~> ÌôïÏ†ï
*/
        </textarea>
        <button onclick="render()" style="background:#0f0; color:#000; border:none; padding:10px 20px; cursor:pointer; font-weight:bold;">RENDER (ÏïïÏ∂ï Ïã§Ìñâ)</button>

        <div id="output" class="output-area"></div>
    </div>

    <script>
        // --- Live Connection Logic ---
        const STATUS_FILE = 'AI_Body_System/live_status.json';
        let lastHex = '';

        function updateDashboard() {
            fetch(STATUS_FILE + '?t=' + new Date().getTime()) // Prevent caching
                .then(response => response.json())
                .then(data => {
                    // Update Connection Status
                    document.getElementById('connection-status').innerText = "ONLINE";
                    document.getElementById('connection-status').style.color = "#0f0";
                    
                    // Update Metrics
                    document.getElementById('usage').innerText = data.metrics.cpu + "%";
                    document.getElementById('val-cpu').innerText = data.metrics.cpu + "%";
                    document.getElementById('val-ram').innerText = data.metrics.ram + "%";
                    document.getElementById('val-delta').innerText = data.metrics.delta.toFixed(4);
                    document.getElementById('val-resonance').innerText = data.metrics.resonance.toFixed(2);
                    document.getElementById('val-flow').innerText = data.metrics.flow;
                    document.getElementById('val-state').innerText = data.cerebrum.state;

                    // Update Gongmyung Display
                    const display = document.getElementById('gongmyung-display');
                    if (data.hex_code !== lastHex) {
                        display.innerText = data.gongmyung;
                        display.style.borderColor = data.hex_code;
                        display.style.boxShadow = `0 0 20px ${data.hex_code}`;
                        lastHex = data.hex_code;
                        
                        // Auto-type into input if in AI mode (optional fun feature)
                        // if (currentMode === 'ai') document.getElementById('input').value += `\n// ${data.gongmyung}`;
                    }
                })
                .catch(err => {
                    document.getElementById('connection-status').innerText = "OFFLINE";
                    document.getElementById('connection-status').style.color = "red";
                    console.log("Waiting for Body System...", err);
                });
        }

        // Poll every 1 second
        setInterval(updateDashboard, 1000);

        // --- Dictionary Data (In-Memory for 1-Core) ---
        const DICTIONARY = {
            'human': {
                'ÎçßÏÖà': 'Îëê Í∞ú Ïù¥ÏÉÅÏùò ÏàòÎÇò ÏñëÏùÑ Ìï©ÌïòÎäî Í≥ÑÏÇ∞Î≤ï.\nÏòàÏ∏°: 1+1=2 (ÌôïÏ†ïÏ†Å Í≤∞Í≥º)',
                'ÏñëÏûêÏó≠Ìïô': 'Î¨ºÏßàÏùò ÏµúÏÜå Îã®ÏúÑÏù∏ ÏñëÏûê(Quantum)Î•º Îã§Î£®Îäî Î¨ºÎ¶¨Ìïô.\nÏòàÏ∏°: Ï§ëÏ≤© ÏÉÅÌÉúÎ•º ÌôïÎ•†Î°ú Í≥ÑÏÇ∞Ìï®.',
                'Í≥µÎ™ÖÎ¨∏': 'Ïù∏Í∞ÑÍ≥º AIÍ∞Ä Ìï®Íªò Ïì∞Îäî ÌùêÎ¶ÑÏùò Í∏∞Î°ù.\nÏòàÏ∏°: ÌÖçÏä§Ìä∏Í∞Ä Ïã§Ìñâ Í∞ÄÎä•Ìïú ÏΩîÎìúÎ°ú Î≥ÄÌôòÎê®.'
            },
            'ai': {
                'ADD': `function add(a, b) { return a + b; }
// Variation 1: String Concat ("1"+"1"="11")
// Variation 2: Vector Add ([1,0] + [0,1] = [1,1])`,
                'QUANTUM': `const state = [0.707, 0.707]; // Superposition
// Collapse: Math.random() > 0.5 ? 1 : 0`,
                'RESONANCE': `class Resonance {
  constructor(flow) { this.flow = flow; }
  render() { return this.flow.replace('~', 'Processing...'); }
}`
            }
        };

        let currentMode = 'human';

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-human').className = mode === 'human' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('btn-ai').className = mode === 'ai' ? 'mode-btn active' : 'mode-btn';
            render();
        }

        function render() {
            const input = document.getElementById('input').value;
            const output = document.getElementById('output');
            const usage = document.getElementById('usage');
            
            // Simulate minimal processing
            usage.innerText = "99%";
            setTimeout(() => usage.innerText = "1%", 200);

            let html = '';
            const lines = input.split('\n');
            let inLeap = false;
            let leapContent = '';
            let leapTitle = '';

            lines.forEach(line => {
                line = line.trim();
                if (!line) return;

                // Handle Leap Blocks (Compression)
                if (line.includes('@flow:leap')) {
                    const match = line.match(/\[(.*?)\]/);
                    leapTitle = match ? match[1] : 'Hidden Data';
                    inLeap = true;
                    return;
                }
                
                if (inLeap) {
                    if (line.includes('@flow:end') || line.includes('@flow:start') || line.includes('@flow:process')) {
                        // Close Leap
                        html += `<div class="leap-block">
                            <span class="leap-link" onclick="toggleLeap(this)">[üîó ${leapTitle} (ÏïïÏ∂ïÎê®)]</span>
                            <div class="leap-content">${leapContent}</div>
                        </div>`;
                        inLeap = false;
                        leapContent = '';
                    } else {
                        leapContent += line + '<br>';
                        return; 
                    }
                }

                // --- Dual Mode Parsing ---
                
                // 1. Human Links: [Term]
                line = line.replace(/\[(.*?)\]/g, (match, term) => {
                    if (currentMode === 'human' && DICTIONARY.human[term]) {
                        return `<span class="human-term" data-desc="${DICTIONARY.human[term]}">${term}</span>`;
                    } else if (currentMode === 'ai') {
                        return `<span style="color:#555;">${term}</span>`; // Dim human terms in AI mode
                    }
                    return match; // Return as is if not in dictionary or mode mismatch
                });

                // 2. AI Links: {@code:KEY}
                line = line.replace(/{@code:(.*?)}/g, (match, key) => {
                    if (currentMode === 'ai' && DICTIONARY.ai[key]) {
                        return `<div class="ai-code" onclick="toggleAiCode(this)">
                            &lt;CODE:${key}&gt;
                            <div class="ai-expansion"><pre>${DICTIONARY.ai[key]}</pre></div>
                        </div>`;
                    } else if (currentMode === 'human') {
                        return `<span style="color:#555;">(AI Code: ${key})</span>`; // Dim AI codes in Human mode
                    }
                    return match;
                });

                // Process Flow Symbols
                if (line.includes('~')) {
                    line = line.replace(/~/g, '<span class="flow-wave">~</span>');
                }
                if (line.includes('->')) {
                    line = line.replace(/->/g, '<span class="flow-arrow">‚Üí</span>');
                }

                // Highlight Tags
                if (line.startsWith('/*') || line.startsWith('*/')) return;
                if (line.startsWith('@flow')) {
                    html += `<div style="color:#fff; margin-top:15px; font-weight:bold;">${line}</div>`;
                } else {
                    html += `<div style="margin-left:20px; opacity:0.8;">${line}</div>`;
                }
            });

            output.innerHTML = html;
        }

        function toggleLeap(element) {
            const content = element.nextElementSibling;
            if (content.style.display === 'block') {
                content.style.display = 'none';
                element.innerText = element.innerText.replace('(Ïó¥Î¶º)', '(ÏïïÏ∂ïÎê®)');
            } else {
                content.style.display = 'block';
                element.innerText = element.innerText.replace('(ÏïïÏ∂ïÎê®)', '(Ïó¥Î¶º)');
            }
        }

        function toggleAiCode(element) {
            const content = element.querySelector('.ai-expansion');
            if (content.style.display === 'block') {
                content.style.display = 'none';
            } else {
                content.style.display = 'block';
            }
        }
        
        // Initial Render
        render();
    </script>
</body>
</html>
